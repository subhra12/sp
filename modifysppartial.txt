SELECT s.*
INTO #TimeData
FROM #Stage s
WHERE 
    s.Status <> 'Unknown'
    AND (
        -- Include rows with BookedHours > 0 (valid bookings)
        s.BookedHours > 0

        -- OR include "Not Booked" rows only if no other status exists for same Emp_ID and TransactionDate
        OR (
            s.Status = 'Not Booked'
            AND NOT EXISTS (
                SELECT 1
                FROM #Stage x
                WHERE x.Emp_ID = s.Emp_ID
                  AND x.TransactionDate = s.TransactionDate
                  AND x.Status <> 'Not Booked'
                  AND ISNULL(x.BookedHours, 0) > 0
            )
        )
    );
