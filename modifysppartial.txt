SELECT s.*
INTO #TimeData
FROM #Stage s
WHERE 
    s.Status <> 'Unknown'
    AND (
        -- Insert rows with BookedHours > 0 (i.e., valid bookings)
        s.BookedHours > 0

        -- OR insert 'Not Booked' only if no other status exists for that Emp_ID and TransactionDate
        OR (
            s.Status = 'Not Booked'
            AND NOT EXISTS (
                SELECT 1
                FROM #Stage x
                WHERE x.Emp_ID = s.Emp_ID
                  AND x.TransactionDate = s.TransactionDate
                  AND x.Status <> 'Not Booked'
            )
            AND NOT EXISTS (
                SELECT 1
                FROM #TimeData td
                WHERE td.Emp_ID = s.Emp_ID
                  AND td.TransactionDate = s.TransactionDate
                  AND td.Status = 'Not Booked'
            )
        )
    );
